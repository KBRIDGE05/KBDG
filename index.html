<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>위험물(UN) 검색 — (이전 UI 복원)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#111830; --line:#1c2547; --text:#e8eefc; --muted:#8aa0c2;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#0b1020;color:var(--text);font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Noto Sans KR,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:960px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;background:rgba(11,16,32,.8);border-bottom:1px solid var(--line);backdrop-filter:blur(6px);z-index:5}
    h1{margin:6px 0 2px;font-weight:800;letter-spacing:-0.3px;font-size:20px}
    .sub{font-size:12px;color:var(--muted);margin-bottom:10px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input[type="text"]{flex:1;min-width:240px;padding:12px 12px;border-radius:12px;border:1px solid var(--line);background:#0c1430;color:#eaf1ff;font-size:14px;outline:none}
    input[type="text"]::placeholder{color:#7d92bb}
    .badge{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;background:#10204a;border:1px solid #27407a;color:#bcd1ff;font-size:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:14px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin-top:12px}
    .item{grid-column:span 12;background:#0f1732;border:1px solid #24356b;border-radius:14px;padding:12px;display:grid;grid-template-columns:90px 1fr;gap:10px}
    .un{font-weight:900;font-size:18px;color:#cfe5ff}
    .cls{color:#9cc3ff;font-size:12px}
    .ko{color:#fff}
    .en{color:#d5ffea}
    .small{font-size:12px;color:#9fb4d8}
    .hint{font-size:12px;color:#9fb4d8;margin-top:4px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>위험물(UN) 검색</h1>
      <div class="sub">이전 UI를 복원했습니다. 동일 폴더의 <code>mof.csv</code>를 자동 로딩하여 전체 검색이 가능합니다.</div>
      <div class="row" style="margin:8px 0 10px">
        <span class="badge">총 데이터: <strong id="recCount">0</strong>건</span>
        <span class="badge">소스: <span id="srcKo">미로딩</span></span>
        <span class="badge">매칭: <strong id="matchCount">0</strong>건</span>
      </div>
      <div class="row">
        <input id="q" type="text" placeholder="예) 1090 / UN3480 / 아세톤 / 리튬 이온 배터리 / Lithium ion batteries">
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="grid" id="results"></div>
    </section>
  </main>

  <script>
    // Minimal app keeping "previous/simple" UI
    const $ = s => document.querySelector(s);
    const elQ = $('#q'), elRes = $('#results');
    const elRecCount = $('#recCount'), elMatch = $('#matchCount'), elSrcKo = $('#srcKo');
    // data store (compatible with previous code)
    window.data = Array.isArray(window.data) ? window.data : [];

    function card(r){
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <div>
          <div class="un">UN ${String(r.un).padStart(4,'0')}</div>
          ${r.cls ? `<div class="cls">Class ${r.cls}</div>` : ''}
        </div>
        <div>
          <div class="ko">${r.nameKo || '<span class="small">한글명 없음</span>'}</div>
          <div class="en">${r.nameEn || '<span class="small">영문명 없음</span>'}</div>
        </div>
      `;
      return div;
    }

    function norm(s){
      return String(s ?? '')
        .normalize('NFKC')
        .toLowerCase()
        .replace(/[\\u0300-\\u036f]/g, '')
        .replace(/[\\s\\-_"'`~!@#$%^&*()\\[\\]{};:,./?+|·<>％%]/g, '');
    }
    const hayCache = new WeakMap();
    function hay(r){
      if(!hayCache.has(r)){
        const pack = [r.un, r.nameKo, r.nameEn, `un${r.un}`, `un-${r.un}`, `un ${r.un}`].filter(Boolean).join(' ');
        hayCache.set(r, norm(pack));
      }
      return hayCache.get(r);
    }
    function matchItem(item, qRaw){
      if(!qRaw) return true;
      const H = hay(item);
      const qn = norm(qRaw);
      if(H.includes(qn)) return true;
      const tokens = qRaw.trim().split(/\\s+/).map(norm).filter(Boolean);
      return tokens.length ? tokens.every(t => H.includes(t)) : true;
    }

    function render(){
      const q = elQ.value || '';
      const filtered = window.data.filter(d => matchItem(d, q)).sort((a,b)=>{
        const nq = norm(q);
        const aExact = nq && norm(String(a.un))===nq;
        const bExact = nq && norm(String(b.un))===nq;
        if(aExact && !bExact) return -1;
        if(bExact && !aExact) return 1;
        return Number(a.un) - Number(b.un);
      });
      elRes.innerHTML = '';
      filtered.forEach(r => elRes.appendChild(card(r)));
      elMatch.textContent = String(filtered.length);
      elRecCount.textContent = String(window.data.length);
    }
    window.render = render;

    elQ.addEventListener('input', render);
  </script>

  <!-- Drop-in loader: autoload mof.csv and re-render (UTF-8/EUC-KR fallback) -->
  <script>
    // Light inline version of loader (so this HTML is fully standalone)
    (function(){
      function parseCSV(text){
        const rows=[]; let i=0, len=text.length;
        let cur='', row=[], inQ=false;
        function pushCell(){ row.push(cur); cur=''; }
        function pushRow(){ rows.push(row); row=[]; }
        while(i<len){
          const ch=text[i];
          if(inQ){
            if(ch=='"'){ if(text[i+1]=='"'){ cur+='"'; i++; } else { inQ=false; } }
            else { cur+=ch; }
          } else {
            if(ch=='"'){ inQ=true; }
            else if(ch==','){ pushCell(); }
            else if(ch=='\\n'){ pushCell(); pushRow(); }
            else if(ch=='\\r'){ /*skip*/ }
            else { cur+=ch; }
          }
          i++;
        }
        if(cur!=='' || row.length){ pushCell(); pushRow(); }
        return rows;
      }
      function norm(s){
        return String(s ?? '').normalize('NFKC').toLowerCase().replace(/[\\u0300-\\u036f]/g,'').replace(/[\\s\\-_"'`~!@#$%^&*()\\[\\]{};:,./?+|·<>％%]/g,'');
      }
      function normalizeHeaders(hs){
        return hs.map(h=> norm(h)
          .replace('un','유엔번호')
          .replace('unnumber','유엔번호')
          .replace('unno','유엔번호')
          .replace('ko','한글물질명')
          .replace('korean','한글물질명')
          .replace('kor','한글물질명')
          .replace('hangul','한글물질명')
          .replace('name','영문물질명')
          .replace('en','영문물질명')
          .replace('english','영문물질명')
          .replace('propershippingname','영문물질명')
          .replace('psn','영문물질명')
        );
      }
      function pickIndex(headers, targets){
        for(let i=0;i<headers.length;i++){ if(targets.some(t=> headers[i].includes(t))) return i; } return -1;
      }
      function ingestRows(rows){
        if(!rows.length) return 0;
        const headers = normalizeHeaders(rows[0]);
        const idxUN  = pickIndex(headers, ['유엔번호']);
        const idxKO  = pickIndex(headers, ['한글물질명','한글명','국문']);
        const idxEN  = pickIndex(headers, ['영문물질명','영문명']);
        const idxCLS = pickIndex(headers, ['class','위험등급']);
        let added=0;
        for(let r=1;r<rows.length;r++){
          const row = rows[r]; if(!row || !row.length) continue;
          const un = String(row[idxUN]||'').match(/\\d{3,4}/)?.[0];
          const nameKo = (row[idxKO]||'').toString().trim();
          const nameEn = (row[idxEN]||'').toString().trim();
          const cls = (idxCLS>=0 ? (row[idxCLS]||'').toString().trim() : '');
          if(!un || (!nameKo && !nameEn)) continue;
          window.data.push({un:Number(un), nameKo, nameEn, cls});
          added++;
        }
        return added;
      }
      async function tryDecode(ab, enc){
        try{
          const td = new TextDecoder(enc);
          const text = td.decode(ab);
          const rows = parseCSV(text);
          const before = window.data.length;
          const added = ingestRows(rows);
          return {enc, added, rows, text, ok:true};
        }catch(e){ return {enc, added:0, rows:[], text:'', ok:false}; }
      }
      async function load(){
        try{
          const res = await fetch('mof.csv', {cache:'no-store'});
          if(!res.ok) throw new Error(res.status+' '+res.statusText);
          const ab = await res.arrayBuffer();
          const results = [];
          results.push(await tryDecode(ab, 'utf-8'));
          results.push(await tryDecode(ab, 'euc-kr'));
          results.push(await tryDecode(ab, 'ms949'));
          const best = results.sort((a,b)=> b.added - a.added)[0];
          document.querySelector('#srcKo').textContent = best && best.added>0 ? `CSV 로딩됨 (+${best.added})` : 'CSV 로드 실패';
          window.render();
        }catch(e){
          console.error('mof.csv load failed:', e);
          document.querySelector('#srcKo').textContent = 'CSV 로드 실패';
        }
      }
      load();
    })();
  </script>
</body>
</html>